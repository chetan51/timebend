(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};a=function(a){function c(){this.animateDuration=b(this.animateDuration,this),this.updateDurationColor=b(this.updateDurationColor,this),this.durationTapped=b(this.durationTapped,this),this.taskHeld=b(this.taskHeld,this),this.taskSwipeAfterIncomplete=b(this.taskSwipeAfterIncomplete,this),this.taskSwipeAfterComplete=b(this.taskSwipeAfterComplete,this),this.taskSwipeInactive=b(this.taskSwipeInactive,this),this.taskSwipeActive=b(this.taskSwipeActive,this),this.nameTapped=b(this.nameTapped,this),this.remove=b(this.remove,this),this.updateName=b(this.updateName,this),this.nameEdited=b(this.nameEdited,this),this.startEditingName=b(this.startEditingName,this),this.editName=b(this.editName,this),this.transformMoveVert=b(this.transformMoveVert,this),this.transformFlipVert=b(this.transformFlipVert,this),this.transform=b(this.transform,this),this.created=b(this.created,this),this.creating=b(this.creating,this),this.render=b(this.render,this),this.template=b(this.template,this),c.__super__.constructor.apply(this,arguments);if(!this.item)throw"@item required";this.item.bind("update",this.render),this.item.bind("destroy",this.remove)}return d(c,a),c.name="TaskItem",c.config={height:40,gutter_width:40},c.prototype.className="task",c.prototype.elements={".content":"content",".name":"name_container",".name .display":"name_display",".name input":"name_input",".duration":"duration",".check":"checkmark",".cross":"cross"},c.prototype.events={"focusout input[type='text']":"nameEdited"},c.prototype.template=function(a){return _.template($("#task-template").html(),{task:a})},c.prototype.render=function(a){var b,d,e,f=this;return a&&(this.item=a),this.item.controller=this,this.el.data("controller",this),this.html(this.template(this.item)),this.updateDurationColor(),e={root:this.el,content:this.content,left_gutter:this.checkmark,right_gutter:this.cross},d={gutter_width:c.config.gutter_width},b={swipeActive:this.taskSwipeActive,swipeInactive:this.taskSwipeInactive,swipeAfterComplete:this.taskSwipeAfterComplete,swipeAfterIncomplete:this.taskSwipeAfterIncomplete},this.item.done&&(d.invert_gutters=["left"]),this.swipeable=new Swipeable(e,d,b),this.el.off("held.task"),this.el.on("held.task",function(a,b){return f.taskHeld()}),this.name_container.off("tapped.task"),this.name_container.on("tapped.task",function(a,b){return f.nameTapped()}),this.duration.off("tapped.task"),this.duration.on("tapped.task",function(a,b){return f.durationTapped()}),this},c.prototype.creating=function(){return this.el.css({height:"0","z-index":"10"})},c.prototype.created=function(){return this.el.css({height:c.config.height+"px","z-index":"100"})},c.prototype.transform=function(a,b,c,d,e,f){var g,h=this;return g={},g[b]=c+d,e?a.css(b)===c+d?f&&f():a.transition(_.extend(g,{complete:function(){return f&&f()}})):a.css(g)},c.prototype.transformFlipVert=function(a,b,c){return this.el.css({transformOrigin:"50% 0"}),this.transform(this.el,"rotateX",a,"deg",b,c)},c.prototype.transformMoveVert=function(a,b,c){return this.transform(this.el,"y",a,"",b,c)},c.prototype.editName=function(){return this.name_display.hide(),this.name_input.show(),this.el.find("input").focus()},c.prototype.startEditingName=function(){return this.el.find("input").val(""),this.editName()},c.prototype.nameEdited=function(){return this.updateName()},c.prototype.updateName=function(a){var b;return b=this.name_input.val(),b.length?(this.item.name=b,a||this.item.save(),this.name_display.show(),this.name_input.hide()):Tasks.trigger("task:delete",this.item)},c.prototype.remove=function(){return this.el.remove()},c.prototype.nameTapped=function(){return app.log("name tapped"),this.editName()},c.prototype.taskSwipeActive=function(a,b){return console.log("task swipe active. direction: "+a),a==="right"?(this.item.done?this.content.removeClass("done"):this.content.addClass("green"),this.toggle_done=!0):this.content.addClass("red")},c.prototype.taskSwipeInactive=function(a,b){return console.log("task swipe inactive. direction: "+a),a==="right"?(this.item.done?this.content.addClass("done"):this.content.removeClass("green"),this.toggle_done=!0):this.content.removeClass("red")},c.prototype.taskSwipeAfterComplete=function(a,b){var c,d;console.log("task swipe after complete. direction: "+a);if(a!=="right")return Tasks.trigger("task:delete",this.item);if(this.toggle_done)return this.item.done=!this.item.done,d=this.item.done?Task.finished():Task.unfinished(),c=d[d.length-1],this.item.order_index=c?c.order_index+1:0,this.item.save(),Tasks.trigger("task:toggle_done",this.item),Agenda.trigger("task:toggle_done",this.item)},c.prototype.taskSwipeAfterIncomplete=function(a,b){return console.log("task swipe after incomplete. direction: "+a),this.toggle_done=!1},c.prototype.taskHeld=function(){return app.log("task held"),this.held=!0},c.prototype.durationTapped=function(){var a,b=this;return app.log("duration tapped"),a=60,this.item.duration>30?a=30:this.item.duration>15&&(a=15),Agenda.trigger("task:duration_changing",this.item,this.item.duration,a),this.animateDuration(this.item.duration,a,500,function(){return b.updateName(!1),b.item.duration=a,b.item.save()})},c.prototype.updateDurationColor=function(a){var b;return a=a?a:this.item.duration,b=a/60,this.duration.css("background-color","rgba(203,222,228, "+b+")")},c.prototype.animateDuration=function(a,b,c,d){var e,f,g,h,i=this;return f=b-a,e=new Date,g=e,h=function(){var b,j;return j=g-e,b=a+f*j/c,i.duration.html(formatMinutesIntoCounter(b)),i.updateDurationColor(b),j>c?d():(g=new Date,delay(10,function(){return h()}))},h()},c}(Spine.Controller),window.TaskItem=a}).call(this);