((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};a=function(a){function c(){this.animateDuration=b(this.animateDuration,this),this.updateDurationColor=b(this.updateDurationColor,this),this.durationTapped=b(this.durationTapped,this),this.taskHeld=b(this.taskHeld,this),this.taskReleased=b(this.taskReleased,this),this.taskSwiping=b(this.taskSwiping,this),this.nameTapped=b(this.nameTapped,this),this.remove=b(this.remove,this),this.updateName=b(this.updateName,this),this.startEditingName=b(this.startEditingName,this),this.editName=b(this.editName,this),this.transformCheckmarkOpacity=b(this.transformCheckmarkOpacity,this),this.transformContentMoveHoriz=b(this.transformContentMoveHoriz,this),this.transformMoveVert=b(this.transformMoveVert,this),this.transformFlipVert=b(this.transformFlipVert,this),this.transform=b(this.transform,this),this.created=b(this.created,this),this.creating=b(this.creating,this),this.render=b(this.render,this),this.template=b(this.template,this),c.__super__.constructor.apply(this,arguments);if(!this.item)throw"@item required";this.item.bind("update",this.render),this.item.bind("destroy",this.remove)}return d(c,a),c.config={height:40,gutter_width:40},c.prototype.className="task",c.prototype.elements={".content":"content",".name":"name_container","input[type='text']":"name_input",".duration":"duration",".check":"checkmark"},c.prototype.events={"focusout input[type='text']":"updateName"},c.prototype.template=function(a){return _.template($("#task-template").html(),{task:a})},c.prototype.render=function(a){var b=this;return a&&(this.item=a),this.item.controller=this,this.html(this.template(this.item)),this.updateDurationColor(),this.el.bind("pullright",function(a,c){if(b.swiping||!c.document_vertical_scrolling)return c.originalEvent.preventDefault(),b.taskSwiping(c.dx)}),this.el.bind("held",function(a,c){return b.taskHeld()}),this.name_container.bind("tapped",function(a,c){return b.nameTapped()}),this.duration.bind("tapped",function(a,c){return b.durationTapped()}),this.el.bind("touchend",function(a,c){return b.taskReleased()}),this},c.prototype.creating=function(){return this.el.css({height:"0","z-index":"10"})},c.prototype.created=function(){return this.el.css({height:c.config.height+"px","z-index":"100"})},c.prototype.transform=function(a,b,c,d,e,f){var g,h=this;return g={},g[b]=c+d,e?a.css(b)===c+d?f&&f():a.transition(_.extend(g,{complete:function(){return f&&f()}})):a.css(g)},c.prototype.transformFlipVert=function(a,b,c){return this.el.css({transformOrigin:"50% 0"}),this.transform(this.el,"rotateX",a,"deg",b,c)},c.prototype.transformMoveVert=function(a,b,c){return this.transform(this.el,"y",a,"",b,c)},c.prototype.transformContentMoveHoriz=function(a,b,c){return this.transform(this.content,"x",a,"",b,c)},c.prototype.transformCheckmarkOpacity=function(a,b,c){return this.transform(this.checkmark,"opacity",a,"",b,c)},c.prototype.editName=function(){return this.el.find("input").focus()},c.prototype.startEditingName=function(){return this.el.find("input").val(""),this.editName()},c.prototype.updateName=function(){var a;return a=this.name_input.val(),a.length?(this.item.name=a,this.item.save()):Tasks.trigger("task:delete",this.item)},c.prototype.remove=function(){return this.el.remove()},c.prototype.nameTapped=function(){return app.log("name tapped"),this.editName()},c.prototype.taskSwiping=function(a){var b,d,e;app.log("task swiping: "+a),this.swiping=!0,d=c.config.gutter_width,a=a>0?a:0,a>d&&(b=a-d,a=d+b/(b/50+1)),this.transformContentMoveHoriz(a);if(a>0)return this.toggle_done=typeof this.toggle_done=="undefined"?!1:this.toggle_done,this.item.done?this.transformCheckmarkOpacity(1-a/d):this.transformCheckmarkOpacity(a/d),e=a>=d?!0:!1,e===!this.toggle_done&&(this.item.done?e?this.content.removeClass("done"):this.content.addClass("done"):e?this.content.addClass("green"):this.content.removeClass("green")),this.toggle_done=e},c.prototype.taskReleased=function(){var a,b,c=this;return this.swiping=!1,this.toggle_done?(this.item.done=!this.item.done,b=this.item.done?Task.finished():Task.unfinished(),a=b[b.length-1],this.item.order_index=a?a.order_index+1:0,this.item.done&&this.content.removeClass("green").addClass("done"),this.transformContentMoveHoriz(0,!0,function(){return c.item.save(),Tasks.trigger("task:toggle_done",c.item)})):this.transformContentMoveHoriz(0,!0)},c.prototype.taskHeld=function(){return app.log("task held")},c.prototype.durationTapped=function(){var a,b=this;return app.log("duration tapped"),a=60,this.item.duration>30?a=30:this.item.duration>15&&(a=15),this.animateDuration(this.item.duration,a,500,function(){return b.item.duration=a,b.item.save()})},c.prototype.updateDurationColor=function(a){var b;return a=a?a:this.item.duration,b=a/60,this.duration.css("background-color","rgba(203,222,228, "+b+")")},c.prototype.animateDuration=function(a,b,c,d){var e,f,g,h,i=this;return f=b-a,e=new Date,g=e,h=function(){var b,j;return j=g-e,b=a+f*j/c,i.duration.html(formatMinutes(b)),i.updateDurationColor(b),j>c?d():(g=new Date,delay(10,function(){return h()}))},h()},c}(Spine.Controller),window.TaskItem=a})).call(this)