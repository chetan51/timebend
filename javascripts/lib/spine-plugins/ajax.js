(function(){var a,b,c,d,e,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},l=[].slice;a=Spine.$,g=Spine.Model,b={getURL:function(a){return a&&(typeof a.url=="function"?a.url():void 0)||a.url},enabled:!0,pending:!1,requests:[],disable:function(a){return this.enabled?(this.enabled=!1,a(),this.enabled=!0):a()},requestNext:function(){var a;return a=this.requests.shift(),a?this.request(a):this.pending=!1},request:function(a){var b=this;return a().complete(function(){return b.requestNext()})},queue:function(a){if(!this.enabled)return;return this.pending?this.requests.push(a):(this.pending=!0,this.request(a)),a}},c=function(){function c(){}return c.name="Base",c.prototype.defaults={contentType:"application/json",dataType:"json",processData:!1,headers:{"X-Requested-With":"XMLHttpRequest"}},c.prototype.ajax=function(b,c){return a.ajax(a.extend({},this.defaults,c,b))},c.prototype.queue=function(a){return b.queue(a)},c}(),d=function(a){function c(a){this.model=a,this.errorResponse=i(this.errorResponse,this),this.recordsResponse=i(this.recordsResponse,this)}return k(c,a),c.name="Collection",c.prototype.find=function(a,c){var d;return d=new this.model({id:a}),this.ajax(c,{type:"GET",url:b.getURL(d)}).success(this.recordsResponse).error(this.errorResponse)},c.prototype.all=function(a){return this.ajax(a,{type:"GET",url:b.getURL(this.model)}).success(this.recordsResponse).error(this.errorResponse)},c.prototype.fetch=function(a,b){var c,d=this;return a==null&&(a={}),b==null&&(b={}),(c=a.id)?(delete a.id,this.find(c,a).success(function(a){return d.model.refresh(a,b)})):this.all(a).success(function(a){return d.model.refresh(a,b)})},c.prototype.recordsResponse=function(a,b,c){return this.model.trigger("ajaxSuccess",null,b,c)},c.prototype.errorResponse=function(a,b,c){return this.model.trigger("ajaxError",null,a,b,c)},c}(c),h=function(a){function c(a){this.record=a,this.errorResponse=i(this.errorResponse,this),this.recordResponse=i(this.recordResponse,this),this.model=this.record.constructor}return k(c,a),c.name="Singleton",c.prototype.reload=function(a,c){var d=this;return this.queue(function(){return d.ajax(a,{type:"GET",url:b.getURL(d.record)}).success(d.recordResponse(c)).error(d.errorResponse(c))})},c.prototype.create=function(a,c){var d=this;return this.queue(function(){return d.ajax(a,{type:"POST",data:JSON.stringify(d.record),url:b.getURL(d.model)}).success(d.recordResponse(c)).error(d.errorResponse(c))})},c.prototype.update=function(a,c){var d=this;return this.queue(function(){return d.ajax(a,{type:"PUT",data:JSON.stringify(d.record),url:b.getURL(d.record)}).success(d.recordResponse(c)).error(d.errorResponse(c))})},c.prototype.destroy=function(a,c){var d=this;return this.queue(function(){return d.ajax(a,{type:"DELETE",url:b.getURL(d.record)}).success(d.recordResponse(c)).error(d.errorResponse(c))})},c.prototype.recordResponse=function(a){var c=this;return a==null&&(a={}),function(d,e,f){var g;return Spine.isBlank(d)?d=!1:d=c.model.fromJSON(d),b.disable(function(){if(d)return d.id&&c.record.id!==d.id&&c.record.changeID(d.id),c.record.updateAttributes(d.attributes())}),c.record.trigger("ajaxSuccess",d,e,f),(g=a.success)!=null?g.apply(c.record):void 0}},c.prototype.errorResponse=function(a){var b=this;return a==null&&(a={}),function(c,d,e){var f;return b.record.trigger("ajaxError",c,d,e),(f=a.error)!=null?f.apply(b.record):void 0}},c}(c),g.host="",f={ajax:function(){return new h(this)},url:function(){var a,c;return a=1<=arguments.length?l.call(arguments,0):[],c=b.getURL(this.constructor),c.charAt(c.length-1)!=="/"&&(c+="/"),c+=encodeURIComponent(this.id),a.unshift(c),a.join("/")}},e={ajax:function(){return new d(this)},url:function(){var a;return a=1<=arguments.length?l.call(arguments,0):[],a.unshift(this.className.toLowerCase()+"s"),a.unshift(g.host),a.join("/")}},g.Ajax={extended:function(){return this.fetch(this.ajaxFetch),this.change(this.ajaxChange),this.extend(e),this.include(f)},ajaxFetch:function(){var a;return(a=this.ajax()).fetch.apply(a,arguments)},ajaxChange:function(a,b,c){c==null&&(c={});if(c.ajax===!1)return;return a.ajax()[b](c.ajax,c)}},g.Ajax.Methods={extended:function(){return this.extend(e),this.include(f)}},b.defaults=c.prototype.defaults,Spine.Ajax=b,typeof module!="undefined"&&module!==null&&(module.exports=b)}).call(this);